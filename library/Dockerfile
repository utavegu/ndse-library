FROM node:18.12-alpine

WORKDIR /app

# Нодемон не взлетит, пока закомментирую, а в идеале 2 разных докер композа... В моем случае получается даже 3 - дев, препродакшн (уже со сборкой, но еще с подключенным вольюмом) и продакшен
ARG NODE_ENV=production

COPY package*.json ./
COPY src/ ./

# Наверное такое себе решение, но еще вчера он не ругался, что вышла новая версия нпм... Да он задолбал так часто обновляться. Уже третий раз эту строчку правлю за время работы над проектом
RUN npm install -g npm@9.1.3
RUN npm i

EXPOSE 3002

# Этот скрипт содержит в себе запуск через nodemon с флагом -L - это одна из составляющих разработки без пересборки контейнера
# CMD [ "npm", "run", "dev" ]
# Прод-вариант (TODO: В идеале понять, почему тот же скрипт через пакадж джейсон не взлетел):
CMD [ "node", "index.js" ]
