FROM node:18.12-alpine

WORKDIR /app

# Нодемон не взлетит, пока закомментирую, а в идеале 2 разных докер композа... В моем случае получается даже 3 - дев, препродакшн (уже со сборкой, но еще с подключенным вольюмом) и продакшен
# tsc тоже не найдет с таким аргом
# ARG NODE_ENV=production

COPY package*.json ./
COPY tsconfig.json ./
COPY src/ ./src

RUN npm i
RUN npm run build

EXPOSE 3002

# Этот скрипт содержит в себе запуск через nodemon с флагом -L - это одна из составляющих разработки без пересборки контейнера
# CMD [ "npm", "run", "dev" ]
# Прод-вариант (TODO: В идеале понять, почему тот же скрипт через пакадж джейсон не взлетел):
CMD [ "npm", "run", "start" ]
